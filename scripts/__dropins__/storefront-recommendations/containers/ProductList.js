/*! Copyright 2025 Adobe
All Rights Reserved. */
import{jsx as t,jsxs as A,Fragment as _}from"@dropins/tools/preact-jsx-runtime.js";import{useState as L,useCallback as E,useEffect as N}from"@dropins/tools/preact-hooks.js";import{Skeleton as K,SkeletonRow as M,ProductItemCard as O,Button as W,Price as H,Image as J}from"@dropins/tools/components.js";import{classes as Q,VComponent as U,Slot as h}from"@dropins/tools/lib.js";import{events as V}from"@dropins/tools/event-bus.js";import{c as X}from"../chunks/getRecommendations.js";import{useText as Y}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";const Z=({className:o,children:f,heading:d,products:u=null,loading:m=!0,...l})=>t("div",{...l,className:Q(["recommendations-product-list",o]),children:m?t(y,{}):A(_,{children:[d&&t(U,{node:d,className:"recommendations-product-list__heading"}),t("div",{className:"recommendations-product-list__content",children:u})]})}),y=()=>t(K,{"data-testid":"recommendations-product-list-skeleton",className:"recommendations-product-list-skeleton",rowGap:"medium",children:[...Array(2)].map((o,f)=>t(M,{variant:"row",size:"large",fullWidth:!0,lines:2,multilineGap:"small"},f))}),oe=({initialData:o=null,hideHeading:f,routeProduct:d,currentSku:u,pageType:m,cartSkus:l,userPurchaseHistory:w,userViewHistory:T,slots:n,...F})=>{var R,b;const[z,g]=L(!o),[s,p]=L(((R=o==null?void 0:o.recommendations)==null?void 0:R.results)||[]),C=Y({addToCartText:"Recommendations.ProductList.addToCart",optionsText:"Recommendations.ProductList.selectOptions",viewProductText:"Recommendations.ProductList.viewProduct"}),k=E(()=>{if(!m)return!1;switch(m){case"Product":return!!u;case"Cart":return!!(l&&l.length>0);case"Category":case"Checkout":case"CMS":default:return!0}},[m,u,l]);if(N(()=>{const e=V.on("recommendations/data",r=>{var a;(a=r==null?void 0:r.items)!=null&&a.length?p([r]):p([]),g(!1)});return()=>{e==null||e.off()}},[]),N(()=>{if(!k()){g(!1);return}g(!0),X({currentSku:u||"",pageType:m,cartSkus:l,userPurchaseHistory:w,userViewHistory:T}).catch(e=>{console.error("Recommendations error:",e),p([]),g(!1)})},[u,m,l,w,T,k]),!k())return null;const I=(e,r)=>{var c,v,x,P;const a={loading:r<4?"eager":"lazy",src:((v=(c=e.images)==null?void 0:c[0])==null?void 0:v.url)||"",alt:((P=(x=e.images)==null?void 0:x[0])==null?void 0:P.label)||"",width:"300",height:"300",params:{width:300}},i=t(J,{"data-testid":"product-list-item-image",...a,"aria-label":e.sku});return t(h,{name:"Thumbnail",slot:n==null?void 0:n.Thumbnail,context:{item:e,defaultImageProps:a},children:d?t("a",{href:d(e),children:i}):i})},S=t(h,{name:"Heading",slot:n==null?void 0:n.Heading,context:{},children:t("div",{"data-testid":"default-product-list-heading",children:((b=s==null?void 0:s[0])==null?void 0:b.title)||C.heading})}),j=(e,r)=>t(h,{name:"Footer",slot:n==null?void 0:n.Footer,context:{product:e,index:r},children:t("div",{"data-testid":"default-product-list-footer",children:d&&t(W,{"data-testid":"default-product-list-footer-button",children:C.viewProductText,"aria-label":C.viewProductText,variant:"primary",onClick:()=>d(e)})})}),B=(e,r)=>t(h,{name:"Title",slot:n==null?void 0:n.Title,context:{item:e,productUrl:r},children:t("a",{href:r,children:e.name})}),G=e=>t(h,{name:"Sku",slot:n==null?void 0:n.Sku,context:{item:e},children:t("span",{children:e.sku})}),$=e=>{var r,a,i,c;return t(h,{name:"Price",slot:n==null?void 0:n.Price,context:{item:e},children:t("div",{"data-testid":"default-product-price",children:t(H,{amount:(a=(r=e.price.final)==null?void 0:r.amount)==null?void 0:a.value,currency:(c=(i=e.price.final)==null?void 0:i.amount)==null?void 0:c.currency})})})},q=t(_,{children:s==null?void 0:s.map(({items:e,totalProducts:r},a)=>r>0?e.map((i,c)=>{const{sku:v,urlKey:x}=i,P=`/${x}`;return t(O,{initialized:!0,sku:G(i),image:I(i,a*e.length+c),titleNode:B(i,P),price:$(i),actionButton:j(i,a*e.length+c)},v)}):null)});return t(Z,{...F,heading:f?void 0:S,loading:z,products:q})};export{oe as ProductList,oe as default};
//# sourceMappingURL=ProductList.js.map
